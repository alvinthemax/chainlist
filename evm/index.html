<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Tambahkan Jaringan EVM Kustom</title>
  <style>
    body{
      font-family:system-ui,Segoe UI,Roboto,Arial;
      margin:0;
      padding:32px;
      background:#f9fafb;
      color:#111827;
    }
    .card{
      max-width:800px;
      margin:0 auto;
      background:#fff;
      padding:24px;
      border-radius:16px;
      box-shadow:0 8px 20px rgba(0,0,0,0.08);
    }
    h2{margin-top:0;font-size:1.5rem;color:#1f2937}
    .subtitle{margin-top:6px;margin-bottom:14px;color:#374151}
    .copy-hint{
      display:inline-block;
      margin-bottom:14px;
      padding:6px 10px;
      background:#f3f4f6;
      border-radius:8px;
      font-size:0.9rem;
      cursor:pointer;
    }
    .copy-hint:hover{background:#e5e7eb}
    .textarea-wrap{position:relative;margin-top:12px}
    textarea{
      width:100%;
      height:220px;
      padding:14px;
      border-radius:12px;
      border:1px solid #d1d5db;
      font-family:monospace;
      font-size:0.95rem;
      resize:vertical;
      box-sizing:border-box;
    }
    textarea::placeholder{
      color:#9ca3af;
    }
    .overlay-btns{
      position:absolute;
      top:8px;
      right:8px;
      display:flex;
      gap:6px;
    }
    .overlay-bottom{
      position:absolute;
      bottom:8px;
      right:8px;
    }
    .icon-btn{
      background:#fff;
      border:1px solid #d1d5db;
      border-radius:8px;
      padding:6px;
      cursor:pointer;
      font-size:1rem;
      line-height:1;
      transition:background 0.2s, border-color 0.2s;
    }
    .icon-btn:hover{background:#f9fafb;border-color:#9ca3af}
    .actions{margin-top:16px;display:flex;gap:10px;flex-wrap:wrap}
    button.main{
      padding:0.8rem 1.4rem;
      font-size:1rem;
      border-radius:10px;
      border:2px solid #2563eb;
      background:#fff;
      color:#2563eb;
      cursor:pointer;
      transition:background 0.2s,color 0.2s;
    }
    button.main:hover{background:#2563eb;color:#fff}
    button.main.green{
      border-color:#059669;
      color:#059669;
    }
    button.main.green:hover{background:#059669;color:#fff}
    .msg{margin-top:14px;font-size:0.95rem;color:#374151;white-space:pre-wrap;min-height:1.2em}
  </style>
</head>
<body>
  <div class="card">
    <h2>Tambahkan Jaringan EVM Kustom</h2>
    <p class="subtitle">Tempel konfigurasi dan Tambahkan Jaringan</p>
    <span id="hint" class="copy-hint">
      Pastikan anda <b>mengubah teks jaringan menjadi JSON dengan format sesuai EIP-3085</b> terlebih dahulu.
    </span>

    <div class="textarea-wrap">
      <textarea id="chainJson" placeholder='{
  "chainId": "",
  "chainName": "",
  "rpcUrls": [""],
  "nativeCurrency": {
    "name": "",
    "symbol": "",
    "decimals": 18
  },
  "blockExplorerUrls": [""]
}'></textarea>
      <div class="overlay-btns">
        <button id="pasteBtn" class="icon-btn" title="Paste">üìã</button>
        <button id="copyBtn" class="icon-btn" title="Copy">üìë</button>
      </div>
      <div class="overlay-bottom">
        <button id="clearBtn" class="icon-btn" title="Clear">‚úñÔ∏è</button>
      </div>
    </div>

    <div class="actions">
      <button id="useExample" class="main green">Gunakan Contoh Sepolia</button>
      <button id="addSwitchBtn" class="main">Add / Switch Chain</button>
    </div>

    <div class="msg" id="msg"></div>
  </div>

  <script>
    const msgEl = document.getElementById('msg');
    const btn = document.getElementById('addSwitchBtn');
    const useExample = document.getElementById('useExample');
    const textarea = document.getElementById('chainJson');
    const pasteBtn = document.getElementById('pasteBtn');
    const copyBtn = document.getElementById('copyBtn');
    const clearBtn = document.getElementById('clearBtn');
    const hint = document.getElementById('hint');

    const SEPOLIA = {
      chainId: "0xaa36a7",
      chainName: "Ethereum Sepolia",
      rpcUrls: ["https://rpc.sepolia.org"],
      nativeCurrency: {
        name: "Sepolia Ether",
        symbol: "ETH",
        decimals: 18
      },
      blockExplorerUrls: ["https://sepolia.etherscan.io"]
    };

    function show(msg, isError=false){
      msgEl.textContent = msg;
      msgEl.style.color = isError ? '#b91c1c' : '#374151';
    }

    function toHexChainId(value){
      if (typeof value === "number") return "0x" + value.toString(16);
      if (typeof value === "string"){
        if (value.startsWith("0x")) return value;
        const n = Number(value);
        if (!Number.isNaN(n)) return "0x" + n.toString(16);
      }
      return value;
    }

    useExample.addEventListener('click', ()=>{
      textarea.value = JSON.stringify(SEPOLIA, null, 2);
      show('Contoh Ethereum Sepolia JSON dimasukkan.');
    });

    pasteBtn.addEventListener('click', async ()=>{
      try {
        const text = await navigator.clipboard.readText();
        textarea.value = text;
        show('Berhasil paste dari clipboard.');
      } catch(e){
        show('Gagal paste: ' + e.message, true);
      }
    });

    copyBtn.addEventListener('click', async ()=>{
      try {
        await navigator.clipboard.writeText(textarea.value);
        show('Teks disalin ke clipboard.');
      } catch(e){
        show('Gagal copy: ' + e.message, true);
      }
    });

    clearBtn.addEventListener('click', ()=>{
      textarea.value = "";
      show('Textarea dikosongkan.');
    });

    hint.addEventListener('click', async ()=>{
      const text = "ubah teks jaringan menjadi JSON dengan format sesuai EIP-3085";
      try {
        await navigator.clipboard.writeText(text);
        show('Teks caption tersalin: "'+text+'"');
      } catch(e){
        show('Gagal copy caption: ' + e.message, true);
      }
    });

    async function addOrSwitch(){
      if (!window.ethereum){
        show('Ethereum provider tidak ditemukan. Pasang MetaMask.', true);
        return;
      }

      let parsed;
      try {
        parsed = JSON.parse(textarea.value);
      } catch(e){
        show('JSON tidak valid: ' + e.message, true);
        return;
      }

      parsed.chainId = toHexChainId(parsed.chainId);

      if (!parsed.chainId || !parsed.rpcUrls){
        show('Config harus ada chainId dan rpcUrls (format EIP-3085).', true);
        return;
      }

      try {
        await window.ethereum.request({
          method: 'wallet_switchEthereumChain',
          params: [{ chainId: parsed.chainId }]
        });
        show(`Berhasil switch ke ${parsed.chainName || parsed.chainId} ‚úÖ`);
      } catch (switchError){
        if (switchError.code === 4902 || /Unrecognized chain/i.test(switchError.message)){
          try {
            await window.ethereum.request({
              method: 'wallet_addEthereumChain',
              params: [parsed]
            });
            show(`${parsed.chainName || parsed.chainId} berhasil ditambahkan ‚úÖ`);
          } catch (addError){
            console.error(addError);
            show('Gagal menambahkan chain: ' + (addError.message || addError), true);
          }
        } else {
          console.error(switchError);
          show('Gagal switch: ' + (switchError.message || switchError), true);
        }
      }
    }

    btn.addEventListener('click', addOrSwitch);
  </script>
</body>
</html>
