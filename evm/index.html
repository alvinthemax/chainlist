<!doctype html>

<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Add Ethereum Chain — Giwa Network</title>
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;margin:24px;background:#f7fafc;color:#0f172a}
    .card{max-width:900px;margin:0 auto;background:white;padding:20px;border-radius:12px;box-shadow:0 6px 18px rgba(2,6,23,0.08)}
    textarea{width:100%;height:160px;padding:12px;border-radius:8px;border:1px solid #e6eef6;font-family:monospace;resize:vertical}
    label{font-weight:600;margin-bottom:6px;display:block}
    .row{display:flex;gap:10px;align-items:center}
    button{background:#0ea5a0;border:none;padding:10px 16px;border-radius:8px;color:white;font-weight:600;cursor:pointer}
    button[disabled]{opacity:.6;cursor:not-allowed}
    pre{background:#0f172a;color:#e6eef6;padding:12px;border-radius:8px;overflow:auto}
    .muted{color:#64748b;font-size:13px}
    .out{margin-top:12px}
  </style>
</head>
<body>
  <div class="card">
    <h1>Add Chain to Wallet</h1>
    <p class="muted">Tempel JSON konfigurasi chain di bawah (atau gunakan tombol <em>Use example</em>), lalu klik <strong>Add Chain</strong> untuk memicu wallet seperti MetaMask.</p><label for="chainJson">Chain JSON</label>
<textarea id="chainJson" aria-label="Chain JSON"></textarea>

<div class="row out">
  <button id="useExample">Use example</button>
  <button id="addChainBtn">Add Chain</button>
  <button id="clearBtn">Clear</button>
</div>

<div class="out">
  <label>Status</label>
  <pre id="log">Ready.

Notes: • Halaman ini memanggil window.ethereum.request dan butuh wallet (MetaMask atau setara). • Gunakan format JSON sesuai EIP-3085 agar popup muncul. </pre> </div>

  </div>  <script>
    const textarea = document.getElementById('chainJson')
    const logEl = document.getElementById('log')
    const addBtn = document.getElementById('addChainBtn')
    const useExample = document.getElementById('useExample')
    const clearBtn = document.getElementById('clearBtn')

    // Gunakan format resmi EIP-3085
    const example = {
      chainId: "0x1650e", // 91342 dalam hex
      chainName: "Giwa Network",
      rpcUrls: ["https://sepolia-rpc.giwa.io"],
      nativeCurrency: {
        name: "Ethereum",
        symbol: "ETH",
        decimals: 18
      },
      blockExplorerUrls: ["https://sepolia-explorer.giwa.io"]
    }

    function log(...args){
      const time = new Date().toLocaleTimeString()
      logEl.textContent = `[${time}] ` + args.join(' ') + '\n' + logEl.textContent
    }

    useExample.addEventListener('click', ()=>{
      textarea.value = JSON.stringify(example, null, 2)
      log('Inserted example JSON')
    })

    clearBtn.addEventListener('click', ()=>{
      textarea.value = ''
      log('Cleared textarea')
    })

    async function addChain(){
      if (!window.ethereum){
        log('window.ethereum not found. Install MetaMask atau wallet lain.')
        alert('Tidak ada wallet terdeteksi. Install MetaMask atau ekstensi kompatibel.')
        return
      }

      let userInput = textarea.value.trim()
      if (!userInput){ log('No input.'); alert('Tempel konfigurasi JSON dulu.'); return }

      let parsed
      try{
        parsed = JSON.parse(userInput)
      }catch(e){
        log('JSON parse error:', e.message)
        alert('JSON tidak valid.')
        return
      }

      if (!parsed.chainId || !parsed.rpcUrls){
        log('Config tidak sesuai EIP-3085:', JSON.stringify(parsed))
        alert('Config harus sesuai format EIP-3085 (ada chainId dan rpcUrls).')
        return
      }

      log('Requesting wallet_addEthereumChain with:', JSON.stringify(parsed))
      addBtn.disabled = true
      try{
        await window.ethereum.request({
          method: 'wallet_addEthereumChain',
          params: [parsed]
        })
        log('Success: chain added')
        alert('Chain berhasil ditambahkan.')
      }catch(err){
        log('Error', err?.message || err)
        if (err?.code === 4001){
          alert('User menolak aksi di wallet.')
        } else {
          alert('Gagal menambahkan chain: ' + (err?.message || String(err)))
        }
      } finally {
        addBtn.disabled = false
      }
    }

    addBtn.addEventListener('click', addChain)

    // Auto isi contoh default
    textarea.value = JSON.stringify(example, null, 2)
  </script></body>
</html>
